<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Financeiro Pro - 2026</title>
    <style>
        :root { 
            --bg: #0f172a; 
            --card: #1e293b; 
            --text: #f1f5f9; 
            --primary: #3b82f6; 
            --border: #334155; 
            --danger: #ff4757; 
            --success: #2ed573; 
            --accent: #8b5cf6;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; padding: 10px; transition: 0.3s; }
        .container { width: 100%; max-width: 450px; }
        
        /* Telas de Bloqueio */
        #login-screen, #setup-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .dots { display: flex; gap: 15px; margin: 20px 0; }
        .dot { width: 18px; height: 18px; border: 2px solid var(--primary); border-radius: 50%; transition: 0.2s; }
        .dot.filled { background: var(--primary); transform: scale(1.2); box-shadow: 0 0 10px var(--primary); }
        
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .key { width: 75px; height: 75px; border-radius: 50%; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; background: var(--card); font-weight: bold; transition: 0.1s; }
        .key:active { background: var(--primary); transform: scale(0.9); }

        #main-app { display: none; width: 100%; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); padding: 20px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 15px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .divida-card { background: linear-gradient(135deg, #ef4444, #7f1d1d); color: white; padding: 20px; border-radius: 24px; margin-bottom: 15px; position: relative; overflow: hidden; }
        
        input, select, button { width: 100%; padding: 14px; margin: 6px 0; border-radius: 14px; border: 1px solid var(--border); background: #0f172a; color: var(--text); font-size: 16px; box-sizing: border-box; }
        .btn-add { background: var(--primary); color: white; border: none; font-weight: bold; padding: 16px; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5); }
        .btn-add:active { transform: scale(0.98); }

        .item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .saida { color: var(--danger); font-weight: bold; }
        .entrada { color: var(--success); font-weight: bold; }
        .btn-icon { background: none; border: none; width: auto; font-size: 18px; cursor: pointer; opacity: 0.7; }
        .btn-backup { background: #334155; color: white; font-size: 11px; padding: 10px; border: none; border-radius: 10px; flex: 1; cursor: pointer; }
    </style>
</head>
<body onload="init()">

<div id="setup-screen" style="display:none;">
    <h2 style="color:var(--primary)">Bem-vindo üöÄ</h2>
    <p style="font-size: 14px; color: gray;">Configure seu acesso r√°pido</p>
    <input type="text" id="user-name" placeholder="Como quer ser chamado?">
    <input type="text" id="user-recovery" placeholder="Sua frase de seguran√ßa">
    <button class="btn-add" onclick="saveSetup()">Criar Conta e Iniciar</button>
</div>

<div id="login-screen">
    <div style="font-size: 40px; margin-bottom: 10px;">üîê</div>
    <h3>Digite seu PIN</h3>
    <div class="dots"><div class="dot" id="dot1"></div><div class="dot" id="dot2"></div><div class="dot" id="dot3"></div><div class="dot" id="dot4"></div></div>
    <div class="keypad">
        <div class="key" onclick="press('1')">1</div><div class="key" onclick="press('2')">2</div><div class="key" onclick="press('3')">3</div>
        <div class="key" onclick="press('4')">4</div><div class="key" onclick="press('5')">5</div><div class="key" onclick="press('6')">6</div>
        <div class="key" onclick="press('7')">7</div><div class="key" onclick="press('8')">8</div><div class="key" onclick="press('9')">9</div>
        <div class="key" onclick="limpar()" style="color:var(--danger)">C</div><div class="key" onclick="press('0')">0</div><div class="key" onclick="apagar()">‚Üê</div>
    </div>
    <button onclick="recuperarPIN()" style="background:none; border:none; color:gray; margin-top: 20px; font-size: 13px; text-decoration: underline;">Esqueci meu PIN</button>
</div>

<div id="main-app" class="container">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 5px;">
        <div>Ol√°, <strong id="display-name" style="color: var(--primary);"></strong> üëã</div>
        <div style="font-size: 12px; background: var(--card); padding: 5px 12px; border-radius: 20px; border: 1px solid var(--border);">v2.0 PRO</div>
    </div>

    <div class="divida-card">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <div><small style="opacity: 0.8;">Contas a Pagar</small><h2 id="total-dividas" style="margin:0; font-size: 28px;">R$ 0,00</h2></div>
            <button onclick="ajustarDivida()" style="width:auto; font-size:10px; background:rgba(255,255,255,0.2); color:white; border:none; padding:8px 12px; border-radius:10px;">Ajustar</button>
        </div>
    </div>

    <div class="card" style="border-left: 5px solid var(--success);">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <div><small style="color:gray;">Saldo Dispon√≠vel</small><h2 id="saldo-geral" style="margin:0; font-size: 28px; color: var(--success);">R$ 0,00</h2></div>
            <button onclick="ajustarSaldo()" style="width:auto; font-size:10px; padding:8px 12px; border-radius:10px; background: var(--bg);">Ajustar</button>
        </div>
    </div>

    <div class="card">
        <b style="display:block; margin-bottom: 10px; color: var(--primary);">+ Novo Lan√ßamento</b>
        <input type="hidden" id="edit-id">
        <input type="text" id="desc" placeholder="Ex: Mercado, Sal√°rio...">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <input type="text" id="valor" placeholder="R$ 0,00" inputmode="decimal">
            <select id="cat">
                <option value="üçï Comida">üçï Comida</option>
                <option value="üè† Casa">üè† Casa</option>
                <option value="üçø Lazer">üçø Lazer</option>
                <option value="üöó Transp.">üöó Transp.</option>
                <option value="üí∞ Sal√°rio">üí∞ Sal√°rio</option>
                <option value="üõ†Ô∏è Outros">üõ†Ô∏è Outros</option>
            </select>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <select id="pagamento">
                <option value="üì± PIX">üì± PIX</option>
                <option value="üí≥ Cart√£o">üí≥ Cart√£o</option>
                <option value="üíµ Dinheiro">üíµ Dinheiro</option>
                <option value="‚ö†Ô∏è D√≠vida">‚ö†Ô∏è D√≠vida</option>
            </select>
            <select id="tipo">
                <option value="saida">Sa√≠da (-)</option>
                <option value="entrada">Entrada (+)</option>
            </select>
        </div>
        <input type="date" id="data">
        <button class="btn-add" id="btn-save" onclick="salvar()">Confirmar Lan√ßamento</button>
    </div>

    <div class="card">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <strong>Hist√≥rico Recente</strong>
            <button onclick="copiarResumo()" style="width:auto; font-size:11px; padding:6px 12px; border-radius:10px; background:var(--accent); color:white; border:none;">üìã Copiar Resumo</button>
        </div>
        <div id="lista"></div>
        <div style="display:flex; gap: 10px; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px;">
            <button onclick="exportarBackup()" class="btn-backup">üì§ Exportar Backup</button>
            <button onclick="importarBackup()" class="btn-backup">üì• Importar Backup</button>
        </div>
    </div>
</div>

<script>
    // Toda a l√≥gica de funcionamento que j√° t√≠nhamos, otimizada
    let registros = JSON.parse(localStorage.getItem('financas_2026_vFinal')) || [];
    let pinSalvo = localStorage.getItem('app_pin');
    let nomeUser = localStorage.getItem('app_user_name');
    let fraseRecuperacao = localStorage.getItem('app_user_recovery');
    let saldoAjuste = parseFloat(localStorage.getItem('app_saldo_ajuste')) || 0;
    let dividaAjuste = parseFloat(localStorage.getItem('app_divida_ajuste')) || 0;
    let pinInput = "";

    function init() {
        if(!nomeUser) { document.getElementById('login-screen').style.display = 'none'; document.getElementById('setup-screen').style.display = 'flex'; }
        else { document.getElementById('display-name').innerText = nomeUser; }
        document.getElementById('data').valueAsDate = new Date();
    }

    function press(n) { if(pinInput.length < 4) pinInput += n; updateDots(); if(pinInput.length === 4) setTimeout(checkPin, 200); }
    function limpar() { pinInput = ""; updateDots(); }
    function apagar() { pinInput = pinInput.slice(0,-1); updateDots(); }
    function updateDots() { for(let i=1; i<=4; i++) document.getElementById('dot'+i).className = i <= pinInput.length ? 'dot filled' : 'dot'; }

    function checkPin() {
        if(!pinSalvo) { localStorage.setItem('app_pin', pinInput); alert("PIN de Seguran√ßa Salvo!"); location.reload(); }
        else if(pinInput === pinSalvo) { document.getElementById('login-screen').style.display = 'none'; document.getElementById('main-app').style.display = 'block'; atualizar(); }
        else { alert("PIN Incorreto!"); limpar(); }
    }

    function saveSetup() {
        const n = document.getElementById('user-name').value;
        const r = document.getElementById('user-recovery').value;
        if(!n || !r) return alert("Preencha os campos para sua seguran√ßa!");
        localStorage.setItem('app_user_name', n);
        localStorage.setItem('app_user_recovery', r);
        location.reload();
    }

    function salvar() {
        const id = document.getElementById('edit-id').value;
        const desc = document.getElementById('desc').value;
        let v = parseFloat(document.getElementById('valor').value.replace(',', '.'));
        if(!desc || isNaN(v)) return alert("Dados inv√°lidos!");

        const novo = { id: id ? parseInt(id) : Date.now(), desc, valor: v, cat: document.getElementById('cat').value, pagamento: document.getElementById('pagamento').value, tipo: document.getElementById('tipo').value, data: document.getElementById('data').value };
        if(id) registros = registros.map(r => r.id === novo.id ? novo : r);
        else registros.push(novo);

        localStorage.setItem('financas_2026_vFinal', JSON.stringify(registros));
        location.reload(); // Recarrega para limpar campos e atualizar tudo
    }

    function atualizar() {
        const lista = document.getElementById('lista'); lista.innerHTML = '';
        let saldo = saldoAjuste, totalDividas = dividaAjuste;

        registros.sort((a,b) => new Date(b.data) - new Date(a.data)).forEach(r => {
            if(r.pagamento.includes("D√≠vida")) totalDividas += r.valor;
            else r.tipo === 'entrada' ? saldo += r.valor : saldo -= r.valor;

            lista.innerHTML += `<div class="item">
                <div><b>${r.cat}</b><br><small style="color:gray">${r.desc} | ${r.data.split('-').reverse().join('/')}</small></div>
                <div style="text-align:right">
                    <span class="${r.tipo}">${r.tipo==='entrada'?'+':'-'} R$ ${r.valor.toFixed(2).replace('.',',')}</span><br>
                    <button class="btn-icon" onclick="editar(${r.id})">‚úèÔ∏è</button>
                    <button class="btn-icon" onclick="excluir(${r.id})">üóëÔ∏è</button>
                </div>
            </div>`;
        });
        document.getElementById('saldo-geral').innerText = "R$ " + saldo.toFixed(2).replace('.',',');
        document.getElementById('total-dividas').innerText = "R$ " + totalDividas.toFixed(2).replace('.',',');
    }

    function editar(id) {
        const r = registros.find(x => x.id === id);
        document.getElementById('edit-id').value = r.id;
        document.getElementById('desc').value = r.desc;
        document.getElementById('valor').value = r.valor;
        document.getElementById('cat').value = r.cat;
        document.getElementById('pagamento').value = r.pagamento;
        document.getElementById('tipo').value = r.tipo;
        document.getElementById('data').value = r.data;
        document.getElementById('btn-save').innerText = "Atualizar Lan√ßamento";
        window.scrollTo(0,0);
    }

    function excluir(id) { if(confirm("Apagar este item?")) { registros = registros.filter(r => r.id !== id); localStorage.setItem('financas_2026_vFinal', JSON.stringify(registros)); atualizar(); } }
    
    function ajustarSaldo() { let v = prompt("Saldo atual:"); if(v) { saldoAjuste = parseFloat(v.replace(',','.')); localStorage.setItem('app_saldo_ajuste', saldoAjuste); atualizar(); } }
    function ajustarDivida() { let v = prompt("D√≠vida atual:"); if(v) { dividaAjuste = parseFloat(v.replace(',','.')); localStorage.setItem('app_divida_ajuste', dividaAjuste); atualizar(); } }

    function exportarBackup() {
        const backup = { registros, nomeUser, fraseRecuperacao, pinSalvo, saldoAjuste, dividaAjuste };
        const codigo = btoa(unescape(encodeURIComponent(JSON.stringify(backup))));
        navigator.clipboard.writeText(codigo).then(() => alert("‚úÖ Backup Copiado!"));
    }

    function importarBackup() {
        const codigo = prompt("Cole o c√≥digo de backup:");
        if(codigo) {
            try {
                const d = JSON.parse(decodeURIComponent(escape(atob(codigo))));
                localStorage.setItem('financas_2026_vFinal', JSON.stringify(d.registros));
                localStorage.setItem('app_user_name', d.nomeUser);
                localStorage.setItem('app_pin', d.pinSalvo);
                location.reload();
            } catch(e) { alert("C√≥digo inv√°lido!"); }
        }
    }
</script>
</body>
</html>
